<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pelixplushd | Tu cine en casa</title>
    <link rel="icon" type="image/png" sizes="32x32" href="fondo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="fondo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="estilos.css">
    <link rel="manifest" href="manifest.json">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <style>
        /* Estilos para el Page Loader para asegurar su funcionamiento */
        .page-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #141414;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .page-loader.active {
            display: flex;
            opacity: 1;
        }

        .page-loader .loader-logo {
            font-size: 2rem;
            font-weight: 900;
            color: #fff;
            margin-bottom: 20px;
        }

        .page-loader .loader-logo span {
            color: #e50914;
        }

        .page-loader .loader-bar {
            width: 150px;
            height: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            position: relative;
            animation: loading-bar-animation 1.5s infinite;
        }

        @keyframes loading-bar-animation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(150px); }
        }

        /* Estilos para el Modal de Selecci√≥n de Pa√≠s */
        .country-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            padding: 20px;
            box-sizing: border-box;
        }

        .country-modal-overlay.active {
            display: flex;
        }

        .country-modal-content {
            background-color: #141414;
            padding: 30px;
            border-radius: 16px;
            width: 100%;
            max-width: 700px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 1px solid #333;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .country-modal-content .logo {
            font-size: 2rem;
            font-weight: 900;
            color: #fff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .country-modal-content .logo img {
            height: 40px;
        }

        .country-modal-content h2 {
            color: #fff;
            margin: 10px 0;
            font-size: 1.8rem;
        }

        .country-modal-content p {
            color: #b3b3b3;
            margin-bottom: 30px;
            font-size: 1rem;
        }

        .country-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }

        .country-item {
            background-color: #2f2f2f;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            border: 2px solid transparent;
        }

        .country-item:hover {
            background-color: #404040;
            transform: translateY(-5px);
            border-color: #e50914;
        }

        .country-item img {
            width: 48px;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }

        .country-item span {
            color: #fff;
            font-size: 0.95rem;
            font-weight: 600;
        }

        @media (max-width: 600px) {
            .country-list {
                grid-template-columns: repeat(2, 1fr);
            }
            .country-modal-content {
                padding: 20px;
            }
            .country-modal-content h2 {
                font-size: 1.5rem;
            }
        }

        /* CORRECCI√ìN IMPORTANTE: Modal de Acceso debe estar oculto inicialmente */
        .access-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            z-index: 20000;
            display: none; /* CAMBIADO: De 'flex' a 'none' */
            justify-content: center;
            align-items: center;
            padding: 20px;
            transition: opacity 0.3s ease;
        }
        
        .access-modal-overlay.active {
            display: flex; /* Solo se muestra cuando tiene clase 'active' */
            opacity: 1;
        }
        
        .access-modal-content {
            background-color: #141414;
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            border: 1px solid #333;
            box-shadow: 0 0 50px rgba(229, 9, 20, 0.3);
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .access-modal-overlay.active .access-modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .access-modal-content .logo { 
            font-size: 2.5rem; 
            margin-bottom: 20px; 
            color: white;
        }
        
        .access-options { 
            display: flex; 
            flex-direction: column; 
            gap: 15px; 
            margin-top: 30px; 
        }
        
        .access-btn {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.2s ease;
            font-weight: 600;
            min-height: 70px;
        }
        .access-btn > * { pointer-events: none; }
        .access-btn:hover { 
            transform: scale(1.03);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .access-btn.free { 
            background: linear-gradient(135deg, #333, #555);
            border: 1px solid #666;
        }
        .access-btn.free:hover {
            background: linear-gradient(135deg, #444, #666);
            border-color: #777;
        }
        .access-btn.vip { 
            background: linear-gradient(135deg, #e50914, #ff4d4d);
            border: 1px solid #ff3333;
        }
        .access-btn.vip:hover {
            background: linear-gradient(135deg, #ff1a1a, #ff6666);
            border-color: #ff4d4d;
        }
        .access-btn small { 
            font-size: 0.85rem; 
            opacity: 0.9; 
            margin-top: 5px; 
            font-weight: normal;
        }
        
        .vip-input { 
            width: 100%; 
            padding: 14px; 
            margin-bottom: 15px; 
            background: #222; 
            border: 1px solid #444; 
            color: white; 
            border-radius: 8px; 
            font-size: 1rem;
            transition: border 0.2s ease;
        }
        .vip-input:focus {
            outline: none;
            border-color: #e50914;
        }
        .validate-btn { 
            background: linear-gradient(135deg, #e50914, #ff4d4d);
            color: white; 
            border: none; 
            padding: 14px; 
            border-radius: 8px; 
            cursor: pointer; 
            width: 100%; 
            font-size: 1rem; 
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .validate-btn:hover {
            background: linear-gradient(135deg, #ff1a1a, #ff6666);
            transform: scale(1.02);
        }
        .back-link { 
            background: none; 
            border: none; 
            color: #999; 
            margin-top: 15px; 
            cursor: pointer; 
            text-decoration: underline; 
            font-size: 0.9rem;
            padding: 5px;
            transition: color 0.2s ease;
        }
        .back-link:hover {
            color: #fff;
        }

        /* Estilos para secciones bloqueadas (Solo VIP) */
        .vip-restricted {
            position: relative !important;
            cursor: pointer;
        }
        .vip-restricted > *:not(.section-title-container) {
            filter: blur(5px);
            user-select: none;
            opacity: 0.6;
            pointer-events: none;
        }
        .vip-restricted::after {
            content: "üîí Haz clic para ser VIP";
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(229, 9, 20, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.3rem;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .vip-restricted:hover::after {
            transform: translate(-50%, -50%) scale(1.05);
            background-color: #e50914;
        }

        /* Seguridad Anti-Robo (UI) */
        body {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Estilos Badge VIP Brillante */
        .vip-badge {
            display: none;
            align-items: center;
            gap: 6px;
            background: linear-gradient(45deg, #FFD700, #FDB931, #FFD700);
            background-size: 200% auto;
            color: #000;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 0.75rem;
            text-transform: uppercase;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
            animation: vipShine 3s linear infinite;
            margin-right: 10px;
            white-space: nowrap;
            cursor: default;
        }
        .vip-badge i { font-size: 0.9rem; }
        @keyframes vipShine { to { background-position: 200% center; } }

        /* Estilos Mejorados para Planes VIP */
        .plan-title {
            color: white;
            margin-bottom: 25px;
            font-size: 1.6rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
        }
        .plan-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }
        .plan-btn {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 2px solid #333;
            border-radius: 16px;
            padding: 20px;
            width: 150px;
            min-height: 160px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }
        .plan-btn > * { pointer-events: none; }
        .plan-btn:hover {
            transform: translateY(-8px) scale(1.03);
            border-color: #e50914;
            background: #333;
            box-shadow: 0 15px 35px rgba(229, 9, 20, 0.3);
        }
        .plan-btn.popular { border-color: #ffd700; }
        .plan-btn.best-value { border-color: #e50914; background: linear-gradient(145deg, #4a0a0a, #2a0000); }
        
        .plan-icon { font-size: 2.2rem; margin-bottom: 15px; color: #ccc; transition: color 0.3s; }
        .plan-btn:hover .plan-icon { color: white; }
        .plan-btn.popular .plan-icon { color: #ffd700; }
        .plan-btn.best-value .plan-icon { color: #e50914; }

        .plan-btn h4 { font-size: 1.2rem; margin: 5px 0; font-weight: 800; }
        .plan-btn .price { font-size: 1.1rem; color: #e50914; font-weight: bold; margin: 0; }
        
        .badge-popular, .badge-best {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            font-weight: bold;
            padding: 4px 12px;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            color: #000;
            white-space: nowrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        .badge-popular { background-color: #ffd700; }
        .badge-best { background-color: #e50914; color: white; }

        @media (max-width: 600px) {
            .plan-options { flex-direction: column; gap: 12px; }
            .plan-btn { 
                width: 100%; 
                min-height: auto;
                flex-direction: row; 
                justify-content: flex-start; 
                padding: 15px 20px;
                text-align: left;
            }
            .plan-icon { margin-bottom: 0; margin-right: 20px; width: 40px; text-align: center; font-size: 1.8rem; }
            .plan-info { display: flex; flex-direction: column; align-items: flex-start; }
            .badge-popular, .badge-best { left: auto; right: 15px; transform: none; border-radius: 0 0 6px 6px; padding: 3px 10px; font-size: 0.6rem; }
            
            .access-modal-content {
                padding: 25px 20px;
                margin: 10px;
            }
            .access-btn {
                padding: 12px 15px;
                min-height: 60px;
            }
        }
        
        @media (max-width: 600px) {
            .vip-badge span { display: none; }
            .vip-badge::after { content: "VIP"; display: inline; }
            .vip-badge { padding: 6px 10px; margin-right: 5px; }
        }
    </style>
</head>

<body>
    <!-- Access Control Modal -->
    <div id="access-modal" class="access-modal-overlay">
        <div class="access-modal-content">
            <div class="logo"><img src="fondo.png" alt="Logo" style="height:50px; vertical-align:middle; margin-right: 10px;"> Pelix<span style="color:#e50914">plushd</span></div>
            <h2 style="color:white; margin-bottom: 10px;">Bienvenido a Pelixplushd</h2>
            <p style="margin-bottom: 15px; color: #ccc;">¬øC√≥mo quieres acceder?</p>
            <p style="font-size: 0.9rem; color: #bbb; margin-bottom: 20px; line-height: 1.5;">
                <strong style="color: #fff;">Gratis:</strong> Aparecer√°n menos pel√≠culas.<br>
                <strong style="color: #e50914;">VIP:</strong> Acceso a TODO el contenido.
            </p>
            
            <div id="access-selection" class="access-options">
                <button id="btn-free" class="access-btn free">
                    <i class="fas fa-user"></i> Entrar Gratis
                    <small>Cat√°logo limitado</small>
                </button>
                <button id="btn-vip" class="access-btn vip">
                    <i class="fas fa-crown"></i> Soy VIP
                    <small>Acceso Total</small>
                </button>
            </div>

            <div id="vip-login-form" style="display:none; margin-top: 20px;">
                <p style="margin-bottom:15px; color:#fff; font-weight: 600;">Introduce tu c√≥digo √∫nico VIP</p>
                <input type="text" id="vip-code-input" placeholder="Ej: VIP-JUAN-001" class="vip-input">
                <button id="btn-validate-vip" class="validate-btn">Validar C√≥digo</button>
                <p id="vip-error" style="color: #e50914; display:none; margin-top: 10px; font-weight:bold; font-size: 0.9rem;"></p>
                
                <p style="margin-top: 15px; font-size: 0.9rem; color: #999;">
                    ¬øNo tienes cuenta? <a href="#" id="link-request-vip" style="color: #e50914; text-decoration: none; font-weight: bold; transition: color 0.2s ease;">Solicitar VIP</a>
                </p>
                
                <button id="btn-back-vip" class="back-link">‚Üê Volver</button>
            </div>

            <!-- Formulario de Solicitud VIP -->
            <div id="vip-request-form" style="display:none; margin-top: 20px;">

                <!-- Paso 1: Selecci√≥n de Plan -->
                <div id="plan-selection-step">
                    <h3 class="plan-title">üöÄ Elige tu Plan VIP</h3>
                    <div class="plan-options">
                        <button class="plan-btn" data-plan="1 Mes" data-price="100">
                            <div class="plan-icon"><i class="fas fa-ticket-alt"></i></div>
                            <div class="plan-info">
                                <h4>1 Mes</h4>
                                <p class="price">$100 MXN</p>
                            </div>
                        </button>
                        <button class="plan-btn popular" data-plan="2 Meses" data-price="200">
                            <div class="badge-popular">POPULAR</div>
                            <div class="plan-icon"><i class="fas fa-fire"></i></div>
                            <div class="plan-info">
                                <h4>2 Meses</h4>
                                <p class="price">$200 MXN</p>
                            </div>
                        </button>
                        <button class="plan-btn best-value" data-plan="1 A√±o" data-price="1500">
                            <div class="badge-best">MEJOR OFERTA</div>
                            <div class="plan-icon"><i class="fas fa-crown"></i></div>
                            <div class="plan-info">
                                <h4>1 A√±o</h4>
                                <p class="price">$1500 MXN</p>
                            </div>
                        </button>
                    </div>
                    <button id="btn-back-request" class="back-link">‚Üê Cancelar</button>
                </div>

                <!-- Paso 2: Instrucciones de Pago -->
                <div id="payment-step" style="display:none; text-align: left;">
                    <h3 style="color: white; margin-bottom: 15px; text-align: center;">Realiza tu Pago</h3>
                    <p style="text-align: center; color: #ccc; margin-bottom: 15px;">Plan seleccionado: <strong id="selected-plan-info" style="color: #FFD700;"></strong></p>
                    <div style="background: #222; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <p style="font-size: 1rem; font-weight: bold; color: #fff;">Pasos para activar:</p>
                        <ol style="font-size: 0.9rem; color: #ccc; padding-left: 20px; margin-top: 10px; line-height: 1.6;">
                            <li>Realiza el pago a la siguiente clave: <br><strong style="color: #FFD700; font-size: 1.1rem; user-select: all;">722969020026125562</strong></li>
                            <li>Escribe el nombre o referencia del pago.</li>
                            <li>Haz clic en "Enviar Comprobante" y adjunta tu recibo en WhatsApp.</li>
                        </ol>
                    </div>
                    <input type="text" id="payment-name-input" placeholder="Nombre usado en el pago" class="vip-input">
                    <button id="btn-send-proof" class="validate-btn" style="background: linear-gradient(135deg, #25D366, #128C7E);"><i class="fab fa-whatsapp"></i> Enviar Comprobante</button>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 10px; text-align: center;">La activaci√≥n puede tardar unos minutos.</p>
                    <button id="btn-back-to-plans" class="back-link">‚Üê Elegir otro plan</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Country Selector Modal -->
    <div id="country-selector-modal" class="country-modal-overlay">
        <div class="country-modal-content">
            <div class="logo"><img src="fondo.png" alt="Pelixplushd Logo" class="logo-icon">Pelix<span>plushd</span></div>
            <h2>Elige tu regi√≥n</h2>
            <p>Selecciona tu pa√≠s para personalizar el contenido y las recomendaciones.</p>
            <div class="country-list">
                <div class="country-item" data-country="MX">
                    <img src="https://flagcdn.com/w40/mx.png" alt="Bandera de M√©xico">
                    <span>M√©xico</span>
                </div>
                <div class="country-item" data-country="AR">
                    <img src="https://flagcdn.com/w40/ar.png" alt="Bandera de Argentina">
                    <span>Argentina</span>
                </div>
                <div class="country-item" data-country="CO">
                    <img src="https://flagcdn.com/w40/co.png" alt="Bandera de Colombia">
                    <span>Colombia</span>
                </div>
                <div class="country-item" data-country="CL">
                    <img src="https://flagcdn.com/w40/cl.png" alt="Bandera de Chile">
                    <span>Chile</span>
                </div>
                <div class="country-item" data-country="PE">
                    <img src="https://flagcdn.com/w40/pe.png" alt="Bandera de Per√∫">
                    <span>Per√∫</span>
                </div>
                <div class="country-item" data-country="VE">
                    <img src="https://flagcdn.com/w40/ve.png" alt="Bandera de Venezuela">
                    <span>Venezuela</span>
                </div>
                <div class="country-item" data-country="EC">
                    <img src="https://flagcdn.com/w40/ec.png" alt="Bandera de Ecuador">
                    <span>Ecuador</span>
                </div>
                <div class="country-item" data-country="BO">
                    <img src="https://flagcdn.com/w40/bo.png" alt="Bandera de Bolivia">
                    <span>Bolivia</span>
                </div>
                <div class="country-item" data-country="PY">
                    <img src="https://flagcdn.com/w40/py.png" alt="Bandera de Paraguay">
                    <span>Paraguay</span>
                </div>
                <div class="country-item" data-country="UY">
                    <img src="https://flagcdn.com/w40/uy.png" alt="Bandera de Uruguay">
                    <span>Uruguay</span>
                </div>
                <div class="country-item" data-country="ES">
                    <img src="https://flagcdn.com/w40/es.png" alt="Bandera de Espa√±a">
                    <span>Espa√±a</span>
                </div>
                <div class="country-item" data-country="US">
                    <img src="https://flagcdn.com/w40/us.png" alt="Bandera de Estados Unidos">
                    <span>EE.UU. (Latino)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Global Page Loader -->
    <div id="page-loader" class="page-loader">
        <div class="loader-content">
            <div class="loader-logo">Pelix<span>plushd</span></div>
            <div class="loader-bar"></div>
        </div>
    </div>

    <!-- Navbar -->
    <header id="main-header" class="navbar">
        <div class="logo-container">
            <a href="index.html" class="logo"><img src="fondo.png" alt="Pelixplushd Logo" class="logo-icon">Pelix<span></span>plushd</a>
        </div>

        <nav class="desktop-nav">
            <a href="index.html" class="active">Inicio</a>
            <a href="lanzamientos.html">Pel√≠culas</a>
            <a href="series.html">Series</a>
            <a href="anime.html">Anime</a>
            <a href="animes1.html">Todos los animes</a>
            <a href="ajustes.html">Ajustes</a>
        </nav>

        <div class="nav-actions">
            <!-- Badge VIP (Solo visible para VIPs) -->
            <div id="vip-badge-display" class="vip-badge">
                <i class="fas fa-crown"></i>
                <span>MIEMBRO VIP</span>
            </div>

            <!-- Bot√≥n de notificaciones -->
            <div class="notifications-dropdown">
                <button id="notifications-btn" class="notifications-btn">
                    <i class="fas fa-bell"></i>
                    <span id="notifications-badge" class="notifications-badge" style="display: none;">0</span>
                </button>
                <div id="notifications-panel" class="notifications-panel">
                    <div class="notifications-header">
                        <h3>Notificaciones</h3>
                        <div class="notifications-actions">
                            <button id="mark-all-read">Marcar todo</button>
                            <button id="clear-notifications">Limpiar</button>
                        </div>
                    </div>
                    <div id="notifications-list" class="notifications-list">
                        <!-- Las notificaciones se cargar√°n aqu√≠ din√°micamente -->
                        <div class="notifications-empty">
                            <i class="far fa-bell"></i>
                            <p>No hay notificaciones</p>
                        </div>
                    </div>
                    <div class="notifications-footer">
                        <a href="notificaciones.html">Ver todas las notificaciones</a>
                    </div>
                </div>
            </div>

            <!-- Barra de b√∫squeda -->
            <div class="search-bar">
                <form id="search-form">
                    <input type="text" id="search-input" placeholder="Buscar..." autocomplete="off">
                    <button type="submit" id="search-button"><i class="fas fa-search"></i></button>
                </form>
                <div id="live-search-results" class="search-results-dropdown"></div>
            </div>

            <button id="hamburger-btn" class="mobile-toggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Side Menu (Mobile) -->
    <div id="side-menu" class="mobile-menu">
        <div class="mobile-menu-header">
            <div class="logo"><img src="fondo.png" alt="Pelixplushd Logo" class="logo-icon">Pelix<span></span>plushd</div>
            <button id="close-side-menu-btn" class="close-btn">&times;</button>
        </div>
        <div class="mobile-nav-links">
            <a href="index.html" class="active"><i class="fas fa-home"></i> Inicio</a>
            <a href="lanzamientos.html"><i class="fas fa-film"></i> Pel√≠culas</a>
            <a href="series.html"><i class="fas fa-tv"></i> Series</a>
            <a href="animes1.html"><i class="fas fa-child"></i> todos los animes</a>
            <a href="anime.html"><i class="fas fa-dragon"></i> Anime</a>
            <a href="ajustes.html"><i class="fas fa-cog"></i> Ajustes</a>
            <a href="animes1.html"><i class="fas fa-child"></i> todos los animes</a>
            <a href="favoritos.html"><i class="fas fa-heart"></i> Favoritos</a>
        </div>
        <div class="mobile-categories">
            <span>Explorar Categor√≠as</span>
            <div class="category-tags">
                <a href="accion.html" class="tag">Acci√≥n</a>
                <a href="aventura.html" class="tag">Aventura</a>
                <a href="comedia.html" class="tag">Comedia</a>
                <a href="drama.html" class="tag">Drama</a>
                <a href="terror.html" class="tag">Terror</a>
                <a href="documental.html" class="tag">Docu</a>
                <a href="ninos.html" class="tag">Ni√±os</a>
            </div>
        </div>
    </div>
    <div id="menu-overlay" class="menu-overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Slider -->
        <div id="hero-section" class="hero-container">
            <!-- Injected by script.js -->
            <div class="hero-indicators"></div>
        </div>

        <!-- Search & Filter Container -->
        <div id="live-search-container" class="search-overlay" style="display:none;">
            <div class="container">
                <h2 id="live-search-title">Resultados</h2>
                <div id="active-filter-container"></div>
                <div id="live-search-grid" class="movie-grid-full"></div>
            </div>
        </div>

        <!-- Content Rows -->
        <div id="main-content-sections" class="content-container">

            <!-- User Personal Sections -->
            <section id="continue-watching-section" class="content-row" style="display:none;">
                <div class="section-title-container">
                    <h2 class="section-title">Seguir Viendo <i class="fas fa-play-circle ml-2"></i></h2>
                </div>
                <div id="continue-watching-grid" class="horizontal-scroll"></div>
            </section>

            <section id="view-history-section" class="content-row" style="display:none;">
                <div class="section-title-container">
                    <h2 class="section-title">Visto recientemente</h2>
                </div>
                <div id="view-history-grid" class="horizontal-scroll"></div>
            </section>

            <section id="recomendaciones-section" class="content-row" style="display:none;">
                <div class="section-title-container">
                    <h2 class="section-title">Recomendado para ti</h2>
                </div>
                <div id="recomendaciones-grid" class="horizontal-scroll"></div>
                <p id="no-recomendaciones" style="display:none;"></p>
            </section>

            <!-- NUEVO: Secci√≥n Mejores Pel√≠culas (API) -->
            <section id="mejores-peliculas-section" class="content-row">
                <div class="section-title-container">
                    <h2 class="section-title">üèÜ Mejores Pel√≠culas</h2>
                </div>
                <div class="carrusel-contenedor">
                    <div id="mejores-peliculas-grid" class="movie-grid"></div>
                </div>
            </section>

            <!-- Dynamic Categories -->
            <section id="tendencias" class="content-row"></section>

            <section id="lanzamientos-recientes" class="content-row"></section>

            <section id="series" class="content-row"></section>

            <section id="todo-lo-nuevo-2025" class="content-row"></section>

            <section id="recientemente-a√±adido" class="content-row"></section>

            <section id="accion" class="content-row"></section>
            <section id="terror" class="content-row"></section>
            <section id="comedia" class="content-row"></section>

            <section id="aventura" class="content-row"></section>
            <section id="drama" class="content-row"></section>
            <section id="documental" class="content-row"></section>
            <section id="anime" class="content-row"></section>
            <section id="ninos" class="content-row"></section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-grid">
            <div class="footer-brand">
                <div class="logo"><img src="fondo.png" alt="Pelixplushd Logo" class="logo-icon">Pelix<span>plushd</span></div>
                <p>La mejor plataforma de streaming para tus pel√≠culas, series y animes favoritos. Disfruta de contenido
                    en alta calidad de forma gratuita.</p>
            </div>

            <div class="footer-links">
                <h3>Navegaci√≥n</h3>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="lanzamientos.html">Pel√≠culas</a></li>
                    <li><a href="series.html">Series</a></li>
                    <li><a href="ajustes.html">Ajustes</a></li>
                    <li><a href="anime.html">Anime</a></li>
                    <li><a href="ninos.html">Ni√±os</a></li>
                </ul>
            </div>

            <div class="footer-links">
                <h3>Legal</h3>
                <ul>
                    <li><a href="#">Privacidad</a></li>
                    <li><a href="#">T√©rminos</a></li>
                    <li><a href="#">DMCA</a></li>
                </ul>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Pelixplushd. Todos los derechos reservados.</p>
        </div>
    </footer>

    <!-- Bottom Nav (Mobile) -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item active">
            <i class="fas fa-home"></i>
            <span>Inicio</span>
        </a>
        <a href="buscar.html" class="nav-item">
            <i class="fas fa-search"></i>
            <span>Buscar</span>
        </a>
        <a href="favoritos.html" class="nav-item">
            <i class="fas fa-heart"></i>
            <span>Favoritos</span>
        </a>
        <a href="ajustes.html" class="nav-item">
            <i class="fas fa-cog"></i>
            <span>Ajustes</span>
        </a>
    </nav>

    <!-- Toast Container for Notifications -->
    <div id="notification-container" class="toast-container"></div>

    <!-- External Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <script src="script.js?v=4"></script>
    <script src="notificaciones.js?v=4"></script>

    <!-- UI Interactions - C√ìDIGO CORREGIDO -->
    <script>
        // ========== SISTEMA DE ACCESO COMPLETO ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM cargado, inicializando sistema de acceso...');
            
            // Elementos del modal de acceso
            const accessModal = document.getElementById('access-modal');
            const btnFree = document.getElementById('btn-free');
            const btnVip = document.getElementById('btn-vip');
            const vipForm = document.getElementById('vip-login-form');
            const accessSelection = document.getElementById('access-selection');
            const btnValidate = document.getElementById('btn-validate-vip');
            const btnBack = document.getElementById('btn-back-vip');
            const vipInput = document.getElementById('vip-code-input');
            const vipError = document.getElementById('vip-error');
            
            // Elementos de Solicitud VIP
            const requestForm = document.getElementById('vip-request-form');
            const linkRequest = document.getElementById('link-request-vip');
            const btnBackRequest = document.getElementById('btn-back-request');
            const planSelectionStep = document.getElementById('plan-selection-step');
            const paymentStep = document.getElementById('payment-step');
            const planButtons = document.querySelectorAll('.plan-btn');
            const selectedPlanInfo = document.getElementById('selected-plan-info');
            const paymentNameInput = document.getElementById('payment-name-input');
            const btnSendProof = document.getElementById('btn-send-proof');
            const btnBackToPlans = document.getElementById('btn-back-to-plans');
            
            // ========== MOSTRAR MODAL SI NO HAY ACCESO ==========
            function checkAccessStatus() {
                const accessGranted = sessionStorage.getItem('pelix_access_granted');
                const accessType = sessionStorage.getItem('pelix_access_type');
                
                if (!accessGranted) {
                    console.log('No hay acceso, mostrando modal...');
                    showAccessModal();
                } else {
                    console.log('Acceso ya concedido:', accessType);
                    hideAccessModal();
                    
                    if (accessType === 'free') {
                        applyFreeRestrictions();
                    } else if (accessType === 'vip') {
                        showVipBadge();
                        validateVipSession(); // Validar sesi√≥n VIP en segundo plano
                    }
                }
            }
            
            function showAccessModal() {
                if (accessModal) {
                    accessModal.classList.add('active');
                    document.body.style.overflow = 'hidden'; // Prevenir scroll
                    console.log('Modal de acceso mostrado');
                }
            }
            
            function hideAccessModal() {
                if (accessModal) {
                    accessModal.classList.remove('active');
                    document.body.style.overflow = ''; // Restaurar scroll
                    console.log('Modal de acceso ocultado');
                }
            }
            
            // ========== BOT√ìN ENTRAR GRATIS ==========
            if (btnFree) {
                btnFree.addEventListener('click', function() {
                    console.log('Bot√≥n Entrar Gratis clickeado');
                    sessionStorage.setItem('pelix_access_granted', 'true');
                    sessionStorage.setItem('pelix_access_type', 'free');
                    hideAccessModal();
                    applyFreeRestrictions();
                    
                    // Mostrar notificaci√≥n
                    if (typeof window.showNotification === 'function') {
                        window.showNotification('Modo Gratuito: Cat√°logo limitado', 'info');
                    } else {
                        console.log('Modo Gratuito activado');
                    }
                });
            }
            
            // ========== BOT√ìN SOY VIP ==========
            if (btnVip) {
                btnVip.addEventListener('click', function() {
                    console.log('Bot√≥n Soy VIP clickeado');
                    if (accessSelection) accessSelection.style.display = 'none';
                    if (vipForm) vipForm.style.display = 'block';
                    if (vipInput) {
                        vipInput.focus();
                        vipInput.value = ''; // Limpiar input
                    }
                    if (vipError) vipError.style.display = 'none';
                });
            }
            
            // ========== VALIDAR C√ìDIGO VIP ==========
            if (btnValidate) {
                btnValidate.addEventListener('click', validateVipCode);
                
                // Permitir validar con Enter
                if (vipInput) {
                    vipInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            validateVipCode();
                        }
                    });
                }
            }
            
            async function validateVipCode() {
                const code = vipInput ? vipInput.value.trim() : "";
                console.log('Validando c√≥digo VIP:', code);
                
                if (!code) {
                    showVipErrorMessage('Por favor, introduce un c√≥digo');
                    return;
                }
                
                try {
                    // Agregamos timestamp para evitar cach√©
                    const response = await fetch(`codigos_vip.json?v=${new Date().getTime()}`);
                    const users = await response.json();
                    const user = users.find(u => u.codigo === code);
                    
                    if (user) {
                        // Verificar si el c√≥digo est√° expirado
                        if (isUserExpired(user)) {
                            const startDate = new Date(user.fecha_inicio + 'T00:00:00');
                            const diasValidez = user.dias_validez || 30;
                            const expirationDate = new Date(startDate);
                            expirationDate.setDate(startDate.getDate() + diasValidez);
                            
                            showVipErrorMessage(`Tu c√≥digo venci√≥ el ${expirationDate.toLocaleDateString()}. Por favor renueva tu suscripci√≥n.`);
                            return;
                        }
                        
                        // C√≥digo v√°lido
                        console.log('C√≥digo VIP v√°lido para:', user.nombre);
                        sessionStorage.setItem('pelix_access_granted', 'true');
                        sessionStorage.setItem('pelix_access_type', 'vip');
                        sessionStorage.setItem('pelix_user_name', user.nombre);
                        sessionStorage.setItem('pelix_user_code', user.codigo);
                        
                        hideAccessModal();
                        showVipBadge();
                        
                        // Mostrar mensaje de bienvenida
                        const welcomeMessage = `¬°Bienvenido VIP, ${user.nombre}!`;
                        if (typeof window.showNotification === 'function') {
                            window.showNotification(welcomeMessage, 'success');
                        } else {
                            alert(welcomeMessage);
                        }
                        
                    } else {
                        showVipErrorMessage('C√≥digo incorrecto o no encontrado');
                    }
                } catch (error) {
                    console.error('Error cargando base de datos:', error);
                    showVipErrorMessage('Error de conexi√≥n con la base de datos');
                }
            }
            
            function showVipErrorMessage(errorMessage) {
                if (vipError) {
                    vipError.textContent = errorMessage;
                    vipError.style.display = 'block';
                    
                    // Auto-ocultar despu√©s de 5 segundos
                    setTimeout(function() {
                        vipError.style.display = 'none';
                    }, 5000);
                }
            }
            
            // ========== VOLVER ==========
            if (btnBack) {
                btnBack.addEventListener('click', function() {
                    console.log('Volviendo a selecci√≥n de acceso');
                    if (vipForm) vipForm.style.display = 'none';
                    if (accessSelection) accessSelection.style.display = 'flex';
                    if (vipError) vipError.style.display = 'none';
                    if (vipInput) vipInput.value = '';
                });
            }
            
            // ========== SOLICITAR VIP ==========
            if (linkRequest) {
                linkRequest.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Solicitando VIP');
                    if (vipForm) vipForm.style.display = 'none';
                    if (requestForm) requestForm.style.display = 'block';
                    if (planSelectionStep) planSelectionStep.style.display = 'block';
                    if (paymentStep) paymentStep.style.display = 'none';
                });
            }
            
            // ========== PLANES VIP ==========
            let selectedPlan = {};
            
            planButtons.forEach(function(btn) {
                btn.addEventListener('click', function() {
                    selectedPlan = {
                        name: btn.dataset.plan,
                        price: btn.dataset.price
                    };
                    console.log('Plan seleccionado:', selectedPlan);
                    
                    if(selectedPlanInfo) selectedPlanInfo.textContent = `${selectedPlan.name} - $${selectedPlan.price} MXN`;
                    if(planSelectionStep) planSelectionStep.style.display = 'none';
                    if(paymentStep) paymentStep.style.display = 'block';
                });
            });
            
            // ========== ENVIAR COMPROBANTE ==========
            if (btnSendProof) {
                btnSendProof.addEventListener('click', function() {
                    const name = paymentNameInput ? paymentNameInput.value.trim() : "";
                    
                    if (!name) {
                        alert("Por favor, escribe el nombre usado en el pago.");
                        return;
                    }
                    
                    const planName = selectedPlan.name || "Plan VIP";
                    const planPrice = selectedPlan.price || "0";
                    const adminPhone = "+525616840524"; 
                    
                    const whatsappMessageContent = `üëã *Hola, quiero activar mi Plan VIP en Pelixplushd.*%0A%0Aüßæ *Detalles del Pago:*%0Aüë§ *Usuario/Ref:* ${name}%0AüìÖ *Plan:* ${planName}%0Aüí∞ *Monto:* $${planPrice} MXN%0A%0Aüìé _Adjunto mi comprobante a continuaci√≥n para su validaci√≥n._%0AüöÄ ¬°Espero mi c√≥digo de acceso!`;
                    
                    window.open(`https://wa.me/${adminPhone}?text=${whatsappMessageContent}`, '_blank');
                });
            }
            
            // ========== VOLVER A PLANES ==========
            if(btnBackToPlans) {
                btnBackToPlans.addEventListener('click', function() {
                    if(paymentStep) paymentStep.style.display = 'none';
                    if(planSelectionStep) planSelectionStep.style.display = 'block';
                });
            }
            
            if (btnBackRequest) {
                btnBackRequest.addEventListener('click', function() {
                    if (requestForm) requestForm.style.display = 'none';
                    if (vipForm) vipForm.style.display = 'block';
                });
            }
            
            // ========== FUNCIONES DE AYUDA ==========
            function isUserExpired(user) {
                if (!user.fecha_inicio) return false;
                const today = new Date();
                const startDate = new Date(user.fecha_inicio + 'T00:00:00');
                const diasValidez = user.dias_validez || 30;
                const expirationDate = new Date(startDate);
                expirationDate.setDate(startDate.getDate() + diasValidez);
                expirationDate.setHours(23, 59, 59, 999);
                return today > expirationDate;
            }
            
            async function validateVipSession() {
                const storedCode = sessionStorage.getItem('pelix_user_code');
                if (!storedCode) return;
                
                try {
                    const response = await fetch(`codigos_vip.json?v=${new Date().getTime()}`);
                    const users = await response.json();
                    const user = users.find(u => u.codigo === storedCode);
                    
                    if (!user || isUserExpired(user)) {
                        // Sesi√≥n expirada o usuario eliminado
                        console.log('Sesi√≥n VIP expirada, cerrando...');
                        sessionStorage.clear();
                        showAccessModal();
                        
                        if (accessSelection) accessSelection.style.display = 'none';
                        if (vipForm) vipForm.style.display = 'block';
                        if (vipError) {
                            vipError.textContent = 'Tu sesi√≥n ha expirado. Por favor, ingresa tu c√≥digo nuevamente.';
                            vipError.style.display = 'block';
                        }
                    }
                } catch (e) {
                    console.error('Error validando sesi√≥n VIP:', e);
                }
            }
            
            function showVipBadge() {
                const badge = document.getElementById('vip-badge-display');
                if (badge) {
                    badge.style.display = 'flex';
                    console.log('Badge VIP mostrado');
                }
            }
            
            function applyFreeRestrictions() {
                console.log('Aplicando restricciones modo gratis');
                
                // Ocultar secciones premium
                const restrictedSections = ['mejores-peliculas-section', 'recomendaciones-section', 'tendencias'];
                restrictedSections.forEach(function(id) {
                    const el = document.getElementById(id);
                    if (el) el.style.display = 'none';
                });
                
                // Bloquear secci√≥n VIP
                const vipSection = document.getElementById('todo-lo-nuevo-2025');
                if (vipSection) {
                    vipSection.classList.add('vip-restricted');
                    vipSection.addEventListener('click', function() {
                        console.log('Secci√≥n VIP clickeada');
                        showAccessModal();
                        if (accessSelection) accessSelection.style.display = 'none';
                        if (vipForm) vipForm.style.display = 'none';
                        if (requestForm) requestForm.style.display = 'block';
                        if (planSelectionStep) planSelectionStep.style.display = 'block';
                        if (paymentStep) paymentStep.style.display = 'none';
                    });
                }
                
                // NUEVO: Bloquear secci√≥n de Series Populares para gratuitos
                const seriesSection = document.getElementById('series');
                if (seriesSection) {
                    seriesSection.classList.add('vip-restricted');
                    
                    // Esperar a que se carguen las tarjetas para limitar a 12
                    const observer = new MutationObserver(() => {
                        const cards = seriesSection.querySelectorAll('.movie-card, .anime-card, .item-card');
                        if (cards.length > 0) {
                            cards.forEach((card, index) => {
                                if (index >= 12) {
                                    card.style.display = 'none';
                                }
                            });
                            observer.disconnect();
                        }
                    });
                    observer.observe(seriesSection, { childList: true, subtree: true });

                    seriesSection.addEventListener('click', function() {
                        console.log('Secci√≥n VIP (Series) clickeada');
                        showAccessModal();
                        if (accessSelection) accessSelection.style.display = 'none';
                        if (vipForm) vipForm.style.display = 'none';
                        if (requestForm) requestForm.style.display = 'block';
                        if (planSelectionStep) planSelectionStep.style.display = 'block';
                        if (paymentStep) paymentStep.style.display = 'none';
                    });
                }
                
                // Ocultar algunas pel√≠culas (simulaci√≥n de cat√°logo limitado)
                setTimeout(function() {
                    document.querySelectorAll('.movie-card, .anime-card, .item-card').forEach(function(card, index) {
                        if (!card.closest('#series') && index % 2 !== 0) {
                            card.style.display = 'none';
                        }
                    });
                }, 1000);
            }
            
            // ========== INICIALIZACI√ìN ==========
            checkAccessStatus();

            // Verificar si viene redirigido para comprar VIP desde Animes
            if (sessionStorage.getItem('trigger_vip_modal') === 'true') {
                sessionStorage.removeItem('trigger_vip_modal');
                setTimeout(() => {
                    showAccessModal();
                    if (accessSelection) accessSelection.style.display = 'none';
                    if (vipForm) vipForm.style.display = 'none';
                    if (requestForm) requestForm.style.display = 'block';
                }, 500);
            }
            
            // Verificar sesi√≥n VIP cada 30 segundos
            setInterval(function() {
                if (sessionStorage.getItem('pelix_access_type') === 'vip') {
                    validateVipSession();
                }
            }, 30000);
        });
        
        // ========== FUNCIONES GLOBALES ==========
        
        // Sticky Header Logic
        window.addEventListener('scroll', function() {
            const header = document.getElementById('main-header');
            if (window.scrollY > 50) header.classList.add('scrolled');
            else header.classList.remove('scrolled');
        });

        // Mobile Menu Logic
        const toggleBtn = document.getElementById('hamburger-btn');
        const closeBtn = document.getElementById('close-side-menu-btn');
        const sideMenu = document.getElementById('side-menu');
        const overlay = document.getElementById('menu-overlay');

        function toggleMenu() {
            sideMenu.classList.toggle('active');
            overlay.classList.toggle('active');
            document.body.style.overflow = sideMenu.classList.contains('active') ? 'hidden' : '';
        }

        if (toggleBtn) toggleBtn.addEventListener('click', toggleMenu);
        if (closeBtn) closeBtn.addEventListener('click', toggleMenu);
        if (overlay) overlay.addEventListener('click', toggleMenu);

        // Rotaci√≥n de fondo del h√©roe
        document.addEventListener('DOMContentLoaded', function() {
            const heroSection = document.getElementById('hero-section');
            if (heroSection) {
                heroSection.style.backgroundImage = `url('fondo.png')`;
                heroSection.style.backgroundSize = 'cover';
                heroSection.style.backgroundPosition = 'center';
            }
        });

        // Bloquear clics en contenido roto
        document.addEventListener('click', function(e) {
            const target = e.target.closest('a, .movie-card, .anime-card, .item-card');
            if (target) {
                const img = target.querySelector('img');
                if (img && img.src.includes('no-disponible.png')) {
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    if (window.showNotification) window.showNotification('Contenido no disponible temporalmente', 'error');
                }
            }
        }, true);

        // Limpiar cach√© autom√°ticamente
        (function autoClearCache() {
          try {
            const SESSION_KEY = 'pelix_cache_cleared';
            const autoCacheClearEnabled = localStorage.getItem('settings_auto_cache_clear') !== 'false';
            
            if (!autoCacheClearEnabled) {
                return;
            }

            if (!sessionStorage.getItem(SESSION_KEY)) {
                if ('caches' in window) {
                    try {
                        const keys = window.caches.keys();
                        keys.then(function(cacheKeys) {
                            cacheKeys.forEach(function(key) {
                                window.caches.delete(key);
                            });
                        });
                        console.log('Cach√© limpiada autom√°ticamente al inicio.');
                    } catch (e) { console.error('Error al limpiar cach√©:', e); }
                }
                sessionStorage.setItem(SESSION_KEY, 'true');
                window.location.reload();
            }
          } catch (e) { console.warn("Cache logic skipped:", e); }
        })();
        
        // Seguridad - Bloquear inspecci√≥n
        document.addEventListener('contextmenu', function(event) { 
            event.preventDefault(); 
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || e.keyCode === 123) {
                e.preventDefault();
                return false;
            }
            
            if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.keyCode === 73)) {
                e.preventDefault();
                return false;
            }
            
            if (e.ctrlKey && e.shiftKey && (e.key === 'C' || e.keyCode === 67)) {
                e.preventDefault();
                return false;
            }
            
            if (e.ctrlKey && e.shiftKey && (e.key === 'J' || e.keyCode === 74)) {
                e.preventDefault();
                return false;
            }
            
            if (e.ctrlKey && (e.key === 'U' || e.keyCode === 85)) {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>
</html>