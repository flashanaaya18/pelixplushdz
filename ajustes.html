<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ajustes - Pelixplushd</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" sizes="32x32" href="fondo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="fondo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="estilos.css?v=4">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#141414">
</head>

<body data-page="Ajustes">

    <header id="main-header" class="navbar">
        <div class="logo-container">
            <a href="index.html" class="logo"><img src="fondo.png" alt="Pelixplushd Logo" class="logo-icon">Pelix<span></span>plushd</a>
        </div>
        <nav class="desktop-nav">
            <a href="index.html">Inicio</a>
            <a href="peliculas.html">Pel칤culas</a>
            <a href="series.html">Series</a>
            <a href="animes1.html">Anime</a>
            <a href="ajustes.html" class="active">Ajustes</a>
        </nav>
        <div class="nav-actions">
            <button id="hamburger-btn" class="mobile-toggle"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <aside id="side-menu" class="mobile-menu">
        <div class="mobile-menu-header">
            <div class="logo"><img src="fondo.png" alt="Pelixplushd Logo" class="logo-icon">Pelix<span>plushd</span></div>
            <button id="close-side-menu-btn"><i class="fas fa-times"></i></button>
        </div>
        <nav class="mobile-nav-links">
            <a href="index.html"><i class="fas fa-home"></i> Inicio</a>
            <a href="peliculas.html"><i class="fas fa-film"></i> Pel칤culas</a>
            <a href="series.html"><i class="fas fa-tv"></i> Series</a>
            <a href="animes1.html"><i class="fas fa-dragon"></i> Anime</a>
            <a href="ajustes.html" class="active"><i class="fas fa-cog"></i> Ajustes</a>
            <a href="favoritos.html"><i class="fas fa-heart"></i> Favoritos</a>
        </nav>
    </aside>
    <div id="menu-overlay" class="menu-overlay"></div>

    <main>
        <div class="ajustes-container">
            <h1><i class="fas fa-cog"></i> Ajustes y Configuraci칩n</h1>

            <!-- Secci칩n VIP Din치mica -->
            <section class="setting-group" id="vip-subscription-section" style="display:none; border: 1px solid #e50914; padding: 15px; border-radius: 8px; background: rgba(229, 9, 20, 0.1);">
                <h2 style="color: #e50914; border-bottom-color: #e50914;">游녬 Mi Suscripci칩n VIP</h2>
                <div class="setting-item">
                    <span>Usuario</span>
                    <span id="vip-username-display" style="font-weight:bold; color:white;">--</span>
                </div>
                <div class="setting-item">
                    <span>Fecha de Vencimiento</span>
                    <span id="vip-expiration-date" style="color: #ccc;">--</span>
                </div>
                <div class="setting-item">
                    <span>Tiempo Restante</span>
                    <span id="vip-time-remaining" style="font-size: 1.1rem; font-weight: bold; color: #fff;">Calculando...</span>
                </div>
                <div class="setting-item">
                    <button id="btn-renew-vip" class="btn-setting" style="width:100%; background-color: #25D366; color: white; margin-top:10px;">
                        <i class="fab fa-whatsapp"></i> Renovar Suscripci칩n
                    </button>
                </div>
            </section>

            <!-- Secci칩n Membres칤a Gratuita (Nueva) -->
            <section class="setting-group" id="free-subscription-section" style="display:none; border: 1px solid #444; padding: 15px; border-radius: 8px; background: rgba(255, 255, 255, 0.05);">
                <h2 style="color: #ccc; border-bottom-color: #444;">游녻 Mi Membres칤a</h2>
                <div class="setting-item">
                    <span>Estado Actual</span>
                    <span style="font-weight:bold; color:white; background: #333; padding: 4px 10px; border-radius: 4px; font-size: 0.9rem;">GRATUITO</span>
                </div>
                <div class="setting-item" style="display:block; margin-top:10px;">
                    <p style="font-size: 0.9rem; color: #aaa; margin-bottom: 15px; line-height: 1.4;">
                        Tienes acceso limitado al cat치logo. <br>
                        <span style="color: #e50914;">춰Hazte VIP para ver todo sin l칤mites!</span>
                    </p>
                    <button id="btn-upgrade-vip" class="btn-setting" style="width:100%; background: linear-gradient(135deg, #e50914, #ff4d4d); color: white; font-weight: bold; border: none; box-shadow: 0 4px 15px rgba(229,9,20,0.3);">
                        <i class="fas fa-crown"></i> Activar Plan VIP
                    </button>
                </div>
            </section>

            <section class="setting-group">
                <h2>Apariencia</h2>
                <div class="setting-item">
                    <span>Modo Claro / Oscuro</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Reducir Animaciones (Mejora rendimiento)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="motion-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Efecto Ambilight por defecto (Modo Cine)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="ambilight-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </section>

            <section class="setting-group">
                <h2>Reproducci칩n</h2>
                <div class="setting-item">
                    <span>Reproducci칩n Autom치tica (Siguiente episodio)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="autoplay-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Saltar intros autom치ticamente</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="skip-intro-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Pa칤s (para idioma por defecto)</span>
                    <select id="country-select" class="btn-setting" style="background: #333; border: 1px solid #444;">
                        <option value="auto">Autom치tico</option>
                        <option value="ES">Espa침a</option>
                        <option value="MX">M칠xico</option>
                        <option value="US">EE.UU. (Subtitulado)</option>
                        <option value="AR">Argentina</option>
                        <option value="CO">Colombia</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Idioma de audio preferido</span>
                    <select id="preferred-lang-select" class="btn-setting" style="background: #333; border: 1px solid #444;">
                        <option value="any">Cualquiera</option>
                        <option value="latino">Latino</option>
                        <option value="castellano">Castellano</option>
                        <option value="subtitulado">Subtitulado</option>
                    </select>
                </div>
            </section>

            <section class="setting-group">
                <h2>Personalizaci칩n</h2>
                <div class="setting-item">
                    <span>Tama침o de Subt칤tulos</span>
                    <select id="subtitle-size-select" class="btn-setting" style="background: #333; border: 1px solid #444;">
                        <option value="100%">Normal</option>
                        <option value="75%">Peque침o</option>
                        <option value="125%">Grande</option>
                        <option value="150%">Muy Grande</option>
                    </select>
                </div>
                <div class="setting-item">
                    <span>Mostrar Calificaciones en Portadas</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-ratings-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Modo Compacto (M치s contenido)</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="compact-mode-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </section>

            <section class="setting-group">
                <h2>Personalizaci칩n de Inicio</h2>
                <div class="setting-item">
                    <span>Mostrar "Seguir Viendo"</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-continue-watching-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Mostrar "Tendencias"</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-trending-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Mostrar "A침adido Recientemente"</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-recently-added-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Mostrar "Recomendado para ti"</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="show-recommendations-toggle" checked>
                        <span class="slider"></span>
                    </label>
                </div>
            </section>

            <section class="setting-group">
                <h2>Datos y Almacenamiento</h2>
                <div class="setting-item">
                    <span>Limpiar cach칠 autom치ticamente al iniciar</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-cache-clear-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>Limpiar historial de "Seguir Viendo"</span>
                    <button id="clear-history-btn" class="btn-setting">Limpiar</button>
                </div>
                <div class="setting-item">
                    <span>Limpiar todos los Favoritos</span>
                    <button id="clear-favorites-btn" class="btn-setting">Limpiar</button>
                </div>
                <div class="setting-item">
                    <span>Limpiar cach칠 de la aplicaci칩n</span>
                    <button id="clear-cache-btn" class="btn-setting">Limpiar</button>
                </div>
                <div class="setting-item">
                    <span>Exportar mis datos (favoritos, historial)</span>
                    <button id="export-data-btn" class="btn-setting">Exportar</button>
                </div>
                <div class="setting-item">
                    <span>Importar mis datos</span>
                    <button id="import-data-btn" class="btn-setting">Importar</button>
                    <input type="file" id="import-data-input" accept=".json" style="display: none;">
                </div>
                <div class="setting-item danger-zone">
                    <span>Restablecer todos los datos de la app</span>
                    <button id="reset-all-btn" class="btn-setting btn-danger">Restablecer App</button>
                </div>
            </section>

            <section class="setting-group">
                <h2>Acerca de</h2>
                <div class="setting-item">
                    <span>Versi칩n de la App</span>
                    <span id="app-version">4.0</span>
                </div>
            </section>
        </div>
    </main>

    <footer class="main-footer">
        <div class="footer-bottom">
            <p>&copy; 2025 Pelixplushd. Todos los derechos reservados.</p>
        </div>
    </footer>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><i class="fas fa-home"></i><span>Inicio</span></a>
        <a href="buscar.html" class="nav-item"><i class="fas fa-search"></i><span>Buscar</span></a>
        <a href="favoritos.html" class="nav-item"><i class="fas fa-heart"></i><span>Favoritos</span></a>
        <a href="ajustes.html" class="nav-item active"><i class="fas fa-cog"></i><span>Ajustes</span></a>
    </nav>

    <div id="notification-container" class="toast-container"></div>

    <script src="script.js?v=4"></script>
    <script src="ajustes.js?v=4"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const vipSection = document.getElementById('vip-subscription-section');
            const freeSection = document.getElementById('free-subscription-section');
            const usernameDisplay = document.getElementById('vip-username-display');
            const expirationDisplay = document.getElementById('vip-expiration-date');
            const timeRemainingDisplay = document.getElementById('vip-time-remaining');
            const btnRenew = document.getElementById('btn-renew-vip');

            const accessType = sessionStorage.getItem('pelix_access_type');
            const userCode = sessionStorage.getItem('pelix_user_code');

            if (accessType === 'vip' && userCode) {
                vipSection.style.display = 'block';
                if(freeSection) freeSection.style.display = 'none';
                
                try {
                    // Obtener datos frescos de la base de datos
                    const response = await fetch(`codigos_vip.json?v=${new Date().getTime()}`);
                    const users = await response.json();
                    const user = users.find(u => u.codigo === userCode);

                    if (user && user.fecha_inicio) {
                        usernameDisplay.textContent = user.nombre;

                        const startDate = new Date(user.fecha_inicio + 'T00:00:00');
                        const diasValidez = user.dias_validez || 30;
                        const expirationDate = new Date(startDate);
                        expirationDate.setDate(startDate.getDate() + diasValidez);
                        // Final del d칤a de vencimiento
                        expirationDate.setHours(23, 59, 59, 999);

                        // Mostrar fecha formateada
                        const options = { year: 'numeric', month: 'long', day: 'numeric' };
                        expirationDisplay.textContent = expirationDate.toLocaleDateString('es-ES', options);

                        // Funci칩n de actualizaci칩n del contador en tiempo real
                        function updateCounter() {
                            const now = new Date();
                            const timeDiff = expirationDate - now;

                            if (timeDiff > 0) {
                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                                
                                timeRemainingDisplay.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
                            } else {
                                // Si el tiempo se acaba, bloquear acceso
                                timeRemainingDisplay.textContent = 'EXPIRADO';
                                timeRemainingDisplay.style.color = 'red';
                                alert('Tu tiempo VIP ha terminado. Por favor renueva.');
                                sessionStorage.clear();
                                window.location.href = 'index.html';
                            }
                        }

                        updateCounter();
                        setInterval(updateCounter, 1000); // Actualizar cada segundo

                        // Bot칩n de renovaci칩n por WhatsApp
                        btnRenew.addEventListener('click', () => {
                            const adminPhone = "+525616840524"; 
                            const message = `Hola, mi suscripci칩n VIP est치 por vencer o venci칩.%0A%0A游녻 Usuario: ${user.nombre}%0A游댐 C칩digo: ${user.codigo}%0A%0AQuiero renovar.`;
                            window.open(`https://wa.me/${adminPhone}?text=${message}`, '_blank');
                        });
                    }
                } catch (e) {
                    console.error("Error verificando suscripci칩n VIP", e);
                }
            } else {
                // Si no es VIP (Gratis o sin sesi칩n), mostrar secci칩n gratuita
                if(freeSection) freeSection.style.display = 'block';
            }
        });
    </script>
</body>

</html>